<!-- 0e141d9d-f619-4f4f-9eac-89ca253bbfdd 4f5035d3-53b8-49de-bf1e-676171767530 -->
# Feature-Sliced Implementation Plan

## Approach

Build features end-to-end, one at a time. Each milestone ships: repository methods, services, and CLI flows needed for that feature. This keeps the app runnable after each step.

## Milestone 1 — Authentication + App Bootstrap

- Repositories: minimal `account_repository` (create, get_by_username/email).
- Utils: `hashing.py` (salt/hash/verify), basic `validators.py`.
- Services: `auth_service.register/login`.
- CLI: `app/__main__.py`, `cli/main.py` with unauthenticated menu (Register, Login, Exit) and post-login role route stubs.
- Config: ensure `settings.py` exposes required env for email later.
- Acceptance: can register and login; user role recognized; errors for bad creds.

## Milestone 2 — Browse Items and Likes (Customer)

- Repositories: `item_repository` (list, get, CRUD read-only now), `liked_item_repository` (like/unlike, list by customer), maintain `item.like_count`.
- Services: `item_service` (list sorted by likes), `like_service` (like/unlike with uniqueness, update like_count atomically).
- CLI: Customer menu — Browse Items, Like/Unlike, View Liked Items.
- Acceptance: liking updates counts; listing sorted by popularity; guards on duplicates.

## Milestone 3 — Inventory Management (Staff)

- Repositories: `item_repository` (create, update, delete, adjust_stock).
- Services: `item_service` (staff CRUD, restock).
- CLI: Staff menu — Create/Update/Delete Items, Restock, View Items.
- Acceptance: item lifecycle works; stock adjustments validated; price and names validated.

## Milestone 4 — Cart and Checkout

- Repositories: `order_repository`, `order_item` ops; transactional writes; decrement item stock.
- Utils: extend validators; `email_service` (mock stdout); `payment_service` (simulate Credit/Debit).
- Services: `cart_service` (in-memory per session), `order_service` (checkout flow with transactions, totals, status/payment updates).
- CLI: Customer — Add/Remove cart items, View cart, Checkout (choose payment method).
- Acceptance: checkout creates order and items, updates stock and order totals, prints receipt.

## Milestone 5 — Messaging (Customer ↔ Staff)

- Repositories: `message_repository` (create, list by conversation, list unread, mark read).
- Services: `messaging_service` (send, list unread, mark read) using `MessageRole`.
- CLI: Customer — Send message, View conversation. Staff — View unread, Reply, Mark read.
- Acceptance: messages persist and unread state behaves per schema.

## Milestone 6 — Reports and Scheduling (CEO)

- Repositories: `report_repository` (create report, add content, fetch by date/type).
- Utils: `scheduling.py` (daily 21:00, month-end triggers).
- Services: `report_service` (aggregate from orders/order_items for window; update `sold_quantity` and `total_revenue`).
- CLI: CEO — View Daily/Weekly/Monthly by range; Trigger regeneration; Show totals and line items.
- Acceptance: reports reflect actual orders; scheduler can call service hooks.

## Cross-Cutting

- Transactions: checkout, restock, report generation.
- Enum values: use exact DB strings (already aligned in models).
- IDs: `account.id` UUID; others INT. Keep mappings consistent in repos.
- Error handling: friendly CLI messages; repository errors surfaced clearly.
- Logging: simple prints for actions in CLI; no DB logic in CLI.

### To-dos

- [ ] Create repositories/base.py with query helpers and mapping
- [ ] Implement account_repository CRUD + lookups
- [ ] Implement item_repository CRUD, stock, popularity listing
- [ ] Implement order_repository with items and status/payment updates
- [ ] Implement message_repository create/list/mark-read
- [ ] Implement liked_item_repository like/unlike/list
- [ ] Implement report_repository create/fetch/add-content
- [ ] Implement utils/hashing.py (salt/hash/verify)
- [ ] Implement utils/validators.py for inputs
- [ ] Implement utils/scheduling.py with daily/month-end jobs
- [ ] Implement auth_service register/login using hashing and repo
- [ ] Implement item_service listing and staff CRUD/restock
- [ ] Implement cart_service in-memory with validations
- [ ] Implement order_service + payment_service + email_service
- [ ] Implement messaging_service and like_service
- [ ] Implement report_service aggregation and persistence
- [ ] Implement app/cli/main.py routing and boot in __main__.py
- [ ] Implement customer_cli flows
- [ ] Implement staff_cli flows
- [ ] Implement ceo_cli flows